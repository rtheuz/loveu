<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>üíñ B & M üíñ</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Uma surpresa rom√¢ntica com m√∫sicas, lembran√ßas e mensagens." />
<meta name="theme-color" content="#ff80ab" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@400;600&display=swap');
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:'Montserrat',sans-serif;
    color:#fff;
    background:#000 center/cover no-repeat fixed;
    transition:background 0.8s ease,color 0.6s ease;
    overflow:auto;
    min-height:100vh;
  }

  /* v√≠deo de fundo mp4 */
  #bgVideo{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:-3;opacity:0;pointer-events:none;transition:opacity .7s}
  /* iframe do YouTube usado como fundo */
  #bgYouTube{
    position:fixed;inset:0;width:100%;height:100%;border:none;z-index:-3;pointer-events:none;opacity:0;transition:opacity .7s;
  }
  /* overlay acima do fundo multim√≠dia */
  #bgOverlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.18),rgba(0,0,0,.45));z-index:-2;pointer-events:none;transition:background .5s}

  /* anima√ß√µes e layout b√°sicos */
  body.loaded h1,body.loaded .container{opacity:1;transform:none}
  h1{font-family:'Pacifico',cursive;font-size:clamp(2rem,6vw,3rem);color:#ffb6c1;text-shadow:0 0 12px rgba(255,105,180,.9);
      margin:28px 0 12px;opacity:0;transform:scale(.9);transition:all .8s cubic-bezier(.2,.9,.3,1);text-align:center}
  .wrap{display:flex;align-items:flex-start;justify-content:center;padding:20px;gap:20px}
  .container{background:rgba(255,255,255,.12);backdrop-filter:blur(6px);padding:22px;border-radius:18px;
      box-shadow:0 6px 30px rgba(0,0,0,.45);max-width:860px;width:100%;opacity:0;transform:scale(.98);transition:all .6s}
  .top{display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap}
  .photo{width:240px;min-width:160px;border-radius:12px;overflow:hidden;border:3px solid rgba(233,30,99,.9);flex-shrink:0}
  .photo img{display:block;width:100%;height:auto}
  .maincol{flex:1;min-width:220px}
  .message{font-weight:600;font-size:1.05rem;margin-bottom:10px;white-space:pre-wrap;text-shadow:0 0 8px rgba(0,0,0,.7)}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .btn{padding:10px 18px;border-radius:24px;border:none;background:linear-gradient(135deg,#ff80ab,#ff4f8b);
      color:#fff;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:.2s}
  .btn:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(255,80,130,.12)}
  .btn:active{transform:translateY(-1px) scale(.995)}
  .btn:focus{outline:3px solid rgba(255,200,220,.6);outline-offset:3px}

  /* Spotify sempre vis√≠vel */
  .spotify-box{
    margin-top:12px;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 0 18px rgba(0,0,0,.35);
    background:rgba(0,0,0,.15);
  }
  iframe.spotify-frame{
    width:100%;
    height:152px;
    border:none;
    border-radius:12px;
  }

  /* painel extra */
  #extraContent{margin-top:18px;display:block;height:0;overflow:hidden;transition:height .45s,opacity .35s;opacity:0}
  #extraContent.open{height:auto;opacity:1;padding-top:12px}
  .extra-inner{display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap}
  .extra-inner img{width:100%;max-width:360px;border-radius:12px;border:2px solid rgba(255,128,171,.9);
      cursor:pointer;object-fit:cover;max-height:60vh}
  .extra-text{flex:1;font-size:1rem;color:#ffeef6}

  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.8);z-index:1000;padding:20px}
  .modal.open{display:flex}
  .modal img{max-width:100%;max-height:90vh;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.6)}

  /* Hearts */
  .heart{position:fixed;bottom:-20px;width:var(--size);height:var(--size);background:var(--color);
      transform:rotate(-45deg);opacity:0;animation:floatHeart var(--duration) linear var(--delay) forwards;z-index:1}
  .heart::before,.heart::after{content:"";position:absolute;width:var(--size);height:var(--size);background:var(--color);border-radius:50%}
  .heart::before{top:calc(var(--size)*-0.5);left:0}.heart::after{left:calc(var(--size)*0.5);top:0}
  @keyframes floatHeart{0%{opacity:0}10%{opacity:var(--opacity)}100%{transform:translate(var(--windX),-110vh) rotate(-45deg);opacity:0}}

  /* confetti simples */
  .confetti{position:fixed;left:0;top:0;width:8px;height:12px;border-radius:2px;opacity:.95;z-index:2;pointer-events:none;
    animation:confettiFall linear forwards}
  @keyframes confettiFall{0%{transform:translateY(-10vh) rotate(0)}100%{transform:translateY(110vh) rotate(540deg);opacity:0}}

  /* Cursor personalizado */
  .cursor{
    position:fixed;
    left:50%;
    top:50%;
    width:28px;
    height:28px;
    border-radius:50%;
    pointer-events:none;
    transform:translate(-50%,-50%);
    z-index:9999;
    mix-blend-mode:screen;
    transition:width .12s ease,height .12s ease,opacity .18s ease;
    will-change:left,top,width,height,opacity;
    background:radial-gradient(circle at 30% 30%,#fff8,transparent 25%),
               linear-gradient(135deg,#ffb6c1,#ff4f8b);
    box-shadow:0 6px 18px rgba(255,80,140,.25);
  }
  .cursor.big{width:52px;height:52px}

  .cursor .c-heart{width:12px;height:12px;transform:rotate(-45deg);background:#fff;border-radius:2px;position:relative}
  .cursor .c-heart::before,.cursor .c-heart::after{content:"";position:absolute;width:12px;height:12px;background:#fff;border-radius:50%}
  .cursor .c-heart::before{top:-6px;left:0}.cursor .c-heart::after{left:6px;top:0}

  body.dark{color:#ffd3e4}
  body.dark h1{color:#ffc1d6}
  body.dark .btn{background:linear-gradient(135deg,#aa3b6a,#ff6f9b)}
  body.dark .container{background:rgba(20,20,20,.65)}
  @media(max-width:600px){.top{flex-direction:column;align-items:center}.photo{width:180px}.container{padding:16px}}

  /* painel de controle */
  #controlPanel{
    position:fixed;top:10px;left:10px;background:rgba(0,0,0,.42);backdrop-filter:blur(6px);
    padding:10px 14px;border-radius:10px;font-size:.85rem;z-index:1200;color:#fff;
    max-width:320px;
  }
  #controlPanel label{display:block;margin-bottom:6px;font-weight:700}
  #controlPanel input, #controlPanel select, #controlPanel button{width:100%;padding:6px 8px;border-radius:8px;border:none;margin-bottom:8px}
  #controlPanel small{opacity:.85;color:#ffd6ea;display:block;margin-bottom:6px}

  /* reduced motion preference */
  @media (prefers-reduced-motion: reduce){
    *{animation:none!important;transition:none!important}
  }
</style>
</head>
<body>
  <!-- background mp4 -->
  <video id="bgVideo" playsinline muted loop></video>
  <!-- background YouTube iframe (used when YouTube URL provided) -->
  <iframe id="bgYouTube" allow="autoplay; fullscreen" sandbox="allow-same-origin allow-scripts allow-presentation"></iframe>
  <div id="bgOverlay"></div>

  <div id="controlPanel" aria-label="Painel de controle">
    <label>üåû Fundo Diurno (imagem, mp4 ou YouTube)</label>
    <input id="dayBgInput" placeholder="URL da imagem, .mp4 ou link YouTube (watch/shorts/youtu.be/playlist)" />
    <label>üåô Fundo Noturno (imagem, mp4 ou YouTube)</label>
    <input id="nightBgInput" placeholder="URL da imagem, .mp4 ou link YouTube (watch/shorts/youtu.be/playlist)" />
    <label>üéß Playlist Spotify</label>
    <input id="spotifyInput" placeholder="Cole o link da playlist (open.spotify.com/playlist/...)" />
    <button id="loadPlaylistBtn" class="btn">‚ñ∂Ô∏è Carregar Playlist</button>
    <small>Use o bot√£o "Tocar Playlist" no card para liberar reprodu√ß√£o em alguns navegadores.</small>
    <label>‚ú® Enfeites</label>
    <select id="decorationSelect">
      <option value="hearts">Cora√ß√µes</option>
      <option value="confetti">Confetti</option>
      <option value="none">Nenhum</option>
    </select>
    <label>üîÅ Redefinir prefer√™ncias</label>
    <button id="resetBtn" class="btn" style="background:linear-gradient(135deg,#ff7676,#ffb199)">Resetar</button>
  </div>

  <h1>üíñ TE AMOOO üíñ</h1>
  <div class="wrap">
    <div class="container" role="main">
      <div class="top">
        <figure class="photo"><img loading="lazy" src="https://i.imgur.com/oK3x5BH.jpeg" alt="Nossa foto juntos" /></figure>
        <div class="maincol">
          <div class="message" id="message" aria-live="polite"></div>
          <div class="controls">
            <button type="button" class="btn" id="playBtn">‚ñ∂Ô∏è Tocar Playlist</button>
            <button type="button" class="btn" id="moreBtn" aria-expanded="false">üíå Ver Mais</button>
            <button type="button" class="btn" id="darkModeBtn">üåô Modo Noturno</button>
          </div>
          <div class="spotify-box" id="spotifyBox">
            <div id="spotifyPlaceholder" style="padding:18px;text-align:center;color:#ffeeff">Playlist n√£o carregada</div>
          </div>
        </div>
      </div>
      <div id="extraContent" aria-hidden="true">
        <div class="extra-inner">
          <div class="extra-text">Algumas lembran√ßas nossas... üíï</div>
          <img class="extra-img" loading="lazy" src="https://i.imgur.com/kUJiuhm.jpeg" alt="Lembran√ßa 1: passeio" />
          <img class="extra-img" loading="lazy" src="https://i.imgur.com/PPq9KND.jpeg" alt="Lembran√ßa 2: abra√ßo" />
          <div class="extra-text">Voc√™ √© a raz√£o do meu sorriso todos os dias üòç</div>
        </div>
      </div>
    </div>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true"><img id="modalImg" src="" alt="Imagem ampliada"></div>
  <div id="cursor" class="cursor" aria-hidden="true"><div class="c-heart"></div></div>

<script>
/* -------------------------
   SONS E MENSAGEM TIPOGRAFIA
   -------------------------*/
const clickSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4b08a875f3.mp3?filename=click-124467.mp3");
const openSound  = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_643244bab6.mp3?filename=magic-124470.mp3");
const heartSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_97ab3022ac.mp3?filename=sparkle-124472.mp3");
clickSound.volume=openSound.volume=heartSound.volume=0.28;

const messageEl=document.getElementById('message');
const text="AMOOR DA MINHA VIDA, MINHA GATINHAA üí´";
let i=0;
function type(){ if(i<text.length){ messageEl.textContent+=text.charAt(i++); setTimeout(type,70) } }

/* -------------------------
   DEFAULTS
   -------------------------*/
const DEFAULT_SPOTIFY_URL = 'https://open.spotify.com/playlist/3AlzaL3fuUAtulQFklJy8v?si=_5BzUq0CQ_WDlL31eLaUcg';

/* -------------------------
   HELPERS YOUTUBE
   -------------------------*/
function parseYouTubeUrl(url){
  if(!url) return null;
  try{
    const u = new URL(url, location.href);
    const hostname = u.hostname.replace('www.','');
    if(hostname === 'youtu.be'){
      const vid = u.pathname.slice(1).split('/')[0];
      if(vid) return {type:'video', id:vid};
    }
    if(hostname === 'youtube.com' || hostname === 'm.youtube.com' || hostname === 'youtube-nocookie.com' || hostname.endsWith('youtube.com')){
      if(u.pathname.startsWith('/playlist') && u.searchParams.get('list')){
        return {type:'playlist', id: u.searchParams.get('list')};
      }
      if(u.searchParams.get('v')){
        const vid = u.searchParams.get('v');
        const list = u.searchParams.get('list');
        if(list) return {type:'playlist', id: list};
        return {type:'video', id: vid};
      }
      const parts = u.pathname.split('/');
      const shortsIdx = parts.indexOf('shorts');
      if(shortsIdx >= 0 && parts[shortsIdx+1]) return {type:'video', id: parts[shortsIdx+1]};
      if(u.pathname.startsWith('/embed/')){
        const id = u.pathname.split('/embed/')[1].split('/')[0];
        return {type:'video', id};
      }
    }
    if(u.searchParams.get('list')) return {type:'playlist', id: u.searchParams.get('list')};
  }catch(e){}
  return null;
}

function isVideoUrl(url){ return url && url.split('?')[0].toLowerCase().endsWith('.mp4'); }

/* -------------------------
   LOAD / INIT
   -------------------------*/
window.addEventListener('load',()=>{
  setTimeout(()=>document.body.classList.add('loaded'),180);
  type();
  // restore preferences
  const savedDM = localStorage.getItem('darkMode');
  if(savedDM === '1'){ document.body.classList.add('dark'); document.getElementById('darkModeBtn').textContent='‚òÄÔ∏è Modo Claro' }
  const savedDec = localStorage.getItem('decoration') || 'hearts';
  document.getElementById('decorationSelect').value = savedDec;
  applyDecoration(savedDec);
  // restore backgrounds and spotify if present
  const day = localStorage.getItem('DAY_BG'); const night = localStorage.getItem('NIGHT_BG');
  if(day) document.getElementById('dayBgInput').value = day;
  if(night) document.getElementById('nightBgInput').value = night;
  const sp = localStorage.getItem('SPOTIFY_URL');
  if(sp){
    document.getElementById('spotifyInput').value = sp;
    injectSpotifyIframe(sp, false);
  } else {
    // load default playlist and persist
    document.getElementById('spotifyInput').value = DEFAULT_SPOTIFY_URL;
    localStorage.setItem('SPOTIFY_URL', DEFAULT_SPOTIFY_URL);
    injectSpotifyIframe(DEFAULT_SPOTIFY_URL, false);
  }
  // apply background if saved
  const savedDay = localStorage.getItem('DAY_BG');
  const savedNight = localStorage.getItem('NIGHT_BG');
  if(savedDay) DAY_BG = savedDay;
  if(savedNight) NIGHT_BG = savedNight;
  applyCurrentBg();
});

/* -------------------------
   CURSOR SUAVE
   -------------------------*/
const cursor=document.getElementById('cursor');
let targetX=window.innerWidth/2,targetY=window.innerHeight/2,currentX=targetX,currentY=targetY,ticking=false;
document.addEventListener('mousemove',e=>{
  targetX=e.clientX;targetY=e.clientY;
  if(!ticking){ticking=true;requestAnimationFrame(updateCursorPosition);}
});
function updateCursorPosition(){
  const lerp=0.22;
  currentX+=(targetX-currentX)*lerp;
  currentY+=(targetY-currentY)*lerp;
  cursor.style.left=currentX+'px';
  cursor.style.top=currentY+'px';
  if(Math.abs(targetX-currentX)>0.5||Math.abs(targetY-currentY)>0.5){requestAnimationFrame(updateCursorPosition);} 
  else{cursor.style.left=targetX+'px';cursor.style.top=targetY+'px';ticking=false;}
}
document.querySelectorAll('button,a,img').forEach(el=>{
  el.addEventListener('mouseenter',()=>cursor.classList.add('big'));
  el.addEventListener('mouseleave',()=>cursor.classList.remove('big'));
});

/* -------------------------
   HEARTS / CONFETTI
   -------------------------*/
const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
let heartsActive = 0, MAX_HEARTS = 20;
function createHeart(){
  if(prefersReduced) return;
  if(heartsActive >= MAX_HEARTS) return;
  heartsActive++;
  const h=document.createElement('div');h.className='heart';
  const s=Math.random()*22+10,d=Math.random()*6+6,del=Math.random()*1.2,hue=Math.random()*360;
  const op=Math.random()*0.45+0.35,wind=(Math.random()-0.5)*140+'px';
  h.style=`--size:${s}px;--color:hsl(${hue},80%,70%);--opacity:${op};--duration:${d}s;--delay:${del}s;--windX:${wind};left:${Math.random()*innerWidth}px`;
  document.body.appendChild(h);
  h.addEventListener('animationend',()=>{h.remove();heartsActive--;});
  try{heartSound.currentTime=0;heartSound.play().catch(()=>{});}catch(e){}
}
function createConfettiBurst(){
  if(prefersReduced) return;
  const burst = Math.floor(8 + Math.random()*14);
  for(let i=0;i<burst;i++){
    const c = document.createElement('div'); c.className='confetti';
    const bg = `hsl(${Math.floor(Math.random()*360)},80%,60%)`;
    c.style.background = bg;
    c.style.left = (Math.random()*100) + 'vw';
    c.style.top = (-5 - Math.random()*10) + 'vh';
    c.style.width = (6 + Math.random()*8) + 'px';
    c.style.height = (8 + Math.random()*10) + 'px';
    c.style.animationDuration = (3 + Math.random()*3) + 's';
    c.style.transform = `rotate(${Math.random()*360}deg)`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),7000);
  }
}

/* -- decoration control -- */
let decInterval = null;
function applyDecoration(name){
  clearInterval(decInterval);
  document.querySelectorAll('.heart, .confetti').forEach(n=>n.remove());
  if(name === 'hearts'){
    decInterval = setInterval(()=>createHeart(), 520);
  } else if(name === 'confetti'){
    decInterval = setInterval(()=>createConfettiBurst(), 1200);
  }
  localStorage.setItem('decoration', name);
}
document.getElementById('decorationSelect').addEventListener('change', e=>{
  applyDecoration(e.target.value);
});

/* -------------------------
   EXTRA (ver imagens)
   -------------------------*/
const moreBtn=document.getElementById('moreBtn'),extra=document.getElementById('extraContent');
let open=false;
moreBtn.onclick=()=>{
  open=!open; try{clickSound.currentTime=0;clickSound.play().catch(()=>{});}catch(e){}
  if(open){extra.classList.add('open');moreBtn.textContent='üíò Ver Menos';moreBtn.setAttribute('aria-expanded','true');try{openSound.play().catch(()=>{});}catch(e){} }
  else{extra.classList.remove('open');moreBtn.textContent='üíå Ver Mais';moreBtn.setAttribute('aria-expanded','false');}
};

const modal=document.getElementById('modal'),modalImg=document.getElementById('modalImg');
const extraImgs = document.querySelectorAll('.extra-img');
extraImgs.forEach(img => {
  img.addEventListener('click', ()=> openModal(img.src, img.alt));
  img.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openModal(img.src, img.alt); } });
  img.setAttribute('tabindex','0');
});
function openModal(src, alt){
  modalImg.src = src; modalImg.alt = alt || 'Imagem ampliada'; modal.classList.add('open');
  modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
  try{openSound.currentTime=0;openSound.play().catch(()=>{});}catch(e){}
  modal.focus && modal.focus();
}
function closeModal(){ modal.classList.remove('open'); modalImg.src=''; modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
document.addEventListener('keydown',(e)=>{ if(e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });

/* -------------------------
   SPOTIFY (trocar playlist) 
   -------------------------*/
const spotifyInput = document.getElementById('spotifyInput');
const loadPlaylistBtn = document.getElementById('loadPlaylistBtn');
const spotifyBox = document.getElementById('spotifyBox');

function normalizeSpotifyUrl(raw){
  if(!raw) return '';
  try{
    const u = new URL(raw.trim());
    if(u.hostname.includes('spotify.com')){
      const parts = u.pathname.split('/');
      const idx = parts.indexOf('playlist');
      if(idx >= 0 && parts[idx+1]) return 'https://open.spotify.com/embed/playlist/' + parts[idx+1] + '?utm_source=generator';
      if(u.pathname.startsWith('/embed/playlist/')) return u.href;
    }
    if(/^[0-9A-Za-z]{20,}$/.test(raw.trim())) return 'https://open.spotify.com/embed/playlist/' + raw.trim() + '?utm_source=generator';
  }catch(e){}
  return '';
}
function injectSpotifyIframe(raw, focus=true){
  const url = normalizeSpotifyUrl(raw);
  spotifyBox.innerHTML = '';
  if(!url){
    spotifyBox.innerHTML = '<div id="spotifyPlaceholder" style="padding:18px;text-align:center;color:#ffeeff">URL inv√°lida. Cole um link de playlist do Spotify.</div>';
    return;
  }
  const ifr = document.createElement('iframe');
  ifr.className = 'spotify-frame';
  ifr.title = 'Playlist do Spotify';
  ifr.loading = 'lazy';
  ifr.allow = 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture';
  ifr.src = url;
  spotifyBox.appendChild(ifr);
  localStorage.setItem('SPOTIFY_URL', raw);
  if(focus) ifr.focus && ifr.focus();
}
loadPlaylistBtn.addEventListener('click', () => {
  const raw = spotifyInput.value.trim();
  injectSpotifyIframe(raw, true);
});

const playBtn=document.getElementById('playBtn');
playBtn.onclick=()=>{
  try{clickSound.currentTime=0;clickSound.play().catch(()=>{});}catch(e){}
  const iframe = spotifyBox.querySelector('iframe');
  if(iframe){
    iframe.focus && iframe.focus();
    playBtn.textContent='üíì Abra o player e pressione play';
    setTimeout(()=>playBtn.textContent='‚ñ∂Ô∏è Tocar Playlist',4000);
  } else {
    playBtn.textContent='‚ùó Carregue uma playlist primeiro';
    setTimeout(()=>playBtn.textContent='‚ñ∂Ô∏è Tocar Playlist',3000);
  }
};

/* -------------------------
   DARK MODE + BACKGROUND (imagem, mp4 ou YouTube)
   -------------------------*/
const darkBtn=document.getElementById('darkModeBtn');
let dark=false;
let DAY_BG = localStorage.getItem('DAY_BG') || 'https://i.imgur.com/0JMLcYr.jpeg';
let NIGHT_BG = localStorage.getItem('NIGHT_BG') || 'https://i.imgur.com/rJePXtj.jpeg';
const dayInput=document.getElementById('dayBgInput'), nightInput=document.getElementById('nightBgInput');

if(localStorage.getItem('darkMode') === '1'){ dark=true; document.body.classList.add('dark'); darkBtn.textContent='‚òÄÔ∏è Modo Claro' }
dayInput.value = DAY_BG; nightInput.value = NIGHT_BG;

const bgVideo = document.getElementById('bgVideo');
const bgYouTube = document.getElementById('bgYouTube');
const overlay = document.getElementById('bgOverlay');

function setBackground(url, opts = {forceImage:false}){
  if(!url) return;
  // primeiro tente YouTube parse
  const yt = parseYouTubeUrl(url);
  if(yt && !opts.forceImage){
    if(yt.type === 'video'){
      const vid = yt.id;
      const embed = `https://www.youtube.com/embed/${vid}?autoplay=1&mute=1&controls=0&rel=0&iv_load_policy=3&modestbranding=1&loop=1&playlist=${vid}&enablejsapi=1`;
      bgYouTube.src = embed;
      bgYouTube.style.opacity = '1';
      bgVideo.pause(); bgVideo.removeAttribute('src'); bgVideo.style.opacity = '0';
      document.body.style.backgroundImage = '';
      return;
    } else if(yt.type === 'playlist'){
      const listId = yt.id;
      const embed = `https://www.youtube.com/embed?autoplay=1&mute=1&controls=0&rel=0&iv_load_policy=3&modestbranding=1&loop=1&enablejsapi=1&listType=playlist&list=${listId}`;
      bgYouTube.src = embed;
      bgYouTube.style.opacity = '1';
      bgVideo.pause(); bgVideo.removeAttribute('src'); bgVideo.style.opacity = '0';
      document.body.style.backgroundImage = '';
      return;
    }
  }

  if(isVideoUrl(url) && !opts.forceImage){
    bgYouTube.removeAttribute('src'); bgYouTube.style.opacity='0';
    bgVideo.src = url;
    bgVideo.load();
    bgVideo.play().catch(()=>{});
    bgVideo.style.opacity = '1';
    document.body.style.backgroundImage = '';
    return;
  }

  bgYouTube.removeAttribute('src'); bgYouTube.style.opacity='0';
  bgVideo.pause(); bgVideo.removeAttribute('src'); bgVideo.style.opacity='0';
  document.body.style.backgroundImage = `url('${url}')`;
  document.body.style.backgroundSize = 'cover';
  document.body.style.backgroundPosition = 'center';
}

function applyCurrentBg(){
  if(dark && NIGHT_BG) setBackground(NIGHT_BG);
  else if(!dark && DAY_BG) setBackground(DAY_BG);
}
applyCurrentBg();

darkBtn.onclick=()=>{
  dark = !dark;
  try{clickSound.currentTime=0;clickSound.play().catch(()=>{});}catch(e){}
  document.body.classList.toggle('dark',dark);
  darkBtn.textContent = dark ? '‚òÄÔ∏è Modo Claro' : 'üåô Modo Noturno';
  localStorage.setItem('darkMode', dark ? '1' : '0');
  applyCurrentBg();
};

// inputs change handling (allow mp4 and YouTube)
function safeUrl(s){ try{ const u = new URL(s, location.href); return u.href; }catch(e){ return s.trim(); } }
dayInput.onchange = () => {
  const v = safeUrl(dayInput.value);
  if(v){ DAY_BG = v; localStorage.setItem('DAY_BG', DAY_BG); if(!dark) setBackground(DAY_BG); }
};
nightInput.onchange = () => {
  const v = safeUrl(nightInput.value);
  if(v){ NIGHT_BG = v; localStorage.setItem('NIGHT_BG', NIGHT_BG); if(dark) setBackground(NIGHT_BG); }
};

/* -------------------------
   Eventos que iniciam enfeites/√°udio no primeiro clique
   -------------------------*/
let userInteracted=false;
function onFirstInteraction(){ userInteracted=true; try{openSound.currentTime=0;openSound.play().catch(()=>{});}catch(e){} document.removeEventListener('pointerdown', onFirstInteraction); }
document.addEventListener('pointerdown', onFirstInteraction, {once:true});

/* -------------------------
   RESET
   -------------------------*/
document.getElementById('resetBtn').addEventListener('click', ()=>{
  localStorage.removeItem('DAY_BG'); localStorage.removeItem('NIGHT_BG'); localStorage.removeItem('SPOTIFY_URL');
  localStorage.removeItem('decoration'); localStorage.removeItem('darkMode');
  dayInput.value=''; nightInput.value=''; spotifyInput.value='';
  DAY_BG = 'https://i.imgur.com/0JMLcYr.jpeg'; NIGHT_BG = 'https://i.imgur.com/rJePXtj.jpeg';
  document.body.classList.remove('dark'); dark=false; darkBtn.textContent='üåô Modo Noturno';
  applyDecoration('hearts'); document.getElementById('decorationSelect').value='hearts';
  setBackground(DAY_BG);
  // re-apply default playlist after reset
  localStorage.setItem('SPOTIFY_URL', DEFAULT_SPOTIFY_URL);
  document.getElementById('spotifyInput').value = DEFAULT_SPOTIFY_URL;
  injectSpotifyIframe(DEFAULT_SPOTIFY_URL, false);
});

/* -------------------------
   Accessibility helpers (small)
   -------------------------*/
modal.setAttribute('tabindex', '-1');
document.addEventListener('visibilitychange', ()=>{ 
  if(document.hidden) {
    if(bgVideo && !bgVideo.paused) bgVideo.pause();
  } else {
    if(bgVideo && bgVideo.src && !bgVideo.paused && !userInteracted) bgVideo.play().catch(()=>{});
  } 
});

if(prefersReduced){
  clearInterval(decInterval);
}
</script>
</body>
</html>
